---
phase: 03-game-loop-scrolling
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - js/config.js
  - js/renderer.js
  - js/main.js
autonomous: true

must_haves:
  truths:
    - "Ground displays as two-tone (bright surface line + darker earth band) with scrolling dash markers"
    - "Ground scrolls left slowly on the READY screen, hinting at runner gameplay"
    - "Config contains 3 obstacle types and 6 gene types with rich data (name, color, spawnRate, movement, educational info for genes)"
    - "Color palette is bold and playful with high contrast"
  artifacts:
    - path: "js/config.js"
      provides: "Bold color palette, ground marker config, rich OBSTACLE_TYPES (3) and GENE_TYPES (6) with educational data"
      contains: "GROUND_MARKER_COLOR"
    - path: "js/renderer.js"
      provides: "drawGround function with two-tone fill and scrolling dash markers"
      exports: ["setupCanvas", "resizeCanvas", "clearCanvas", "drawText", "drawGround"]
    - path: "js/main.js"
      provides: "groundOffset variable updated per frame, calls drawGround instead of drawGroundLine"
      contains: "groundOffset"
  key_links:
    - from: "js/main.js"
      to: "js/renderer.js"
      via: "import drawGround (replaces drawGroundLine)"
      pattern: "import.*drawGround.*from.*renderer"
    - from: "js/renderer.js"
      to: "js/config.js"
      via: "reads GROUND_MARKER_COLOR, GROUND_COLOR, GROUND_LINE_COLOR from config"
      pattern: "config\\.GROUND_MARKER_COLOR"
    - from: "js/main.js"
      to: "js/config.js"
      via: "reads READY_SCROLL_SPEED for slow idle scroll"
      pattern: "READY_SCROLL_SPEED|groundOffset"
---

<objective>
Expand config.js with a bold playful color palette, rich data-driven entity arrays (3 obstacles, 6 genes with educational info), and ground marker configuration. Replace the static ground rendering with a scrolling two-tone ground that has visible dash markers moving left, creating the illusion of motion even on the READY screen.

Purpose: Establishes the visual foundation and data structures that all subsequent Phase 3 work (state machine, HUD) and Phase 4+ (spawning, collision) depend on. The scrolling ground is the first visible sign that this is a runner game.

Output: Updated config.js, renderer.js with drawGround, and main.js with groundOffset tracking.
</objective>

<execution_context>
@C:\Users\bernt\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\bernt\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-game-loop-scrolling/03-CONTEXT.md
@.planning/phases/03-game-loop-scrolling/03-RESEARCH.md
@js/config.js
@js/renderer.js
@js/main.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Expand config.js with bold palette, ground markers, and rich entity arrays</name>
  <files>js/config.js</files>
  <action>
Replace the entire config.js with an expanded version. Keep all existing values and their comments, then add/modify:

**Color palette changes (bold and playful):**
- BACKGROUND_COLOR: keep '#1a1a2e' (deep navy provides contrast base)
- GROUND_COLOR: change to '#2C5F8A' (medium blue-grey earth band)
- GROUND_LINE_COLOR: change to '#4A90D9' (bright blue surface line)
- GROUND_LINE_WIDTH: change to 4 (up from 2 for visibility)
- TEXT_COLOR: keep '#FFFFFF'
- PLAYER_COLOR: keep '#00FF00' (Phase 2 placeholder)

**New ground marker config:**
- GROUND_MARKER_COLOR: '#3A78C2' (slightly darker than surface line)
- GROUND_MARKER_WIDTH: 20 (px, dash width)
- GROUND_MARKER_HEIGHT: 4 (px, dash height)
- GROUND_MARKER_SPACING: 100 (px, total repeat distance: 20px dash + 80px gap)
- GROUND_MARKER_Y_OFFSET: 12 (px below GROUND_Y surface edge)

**New scroll speed config:**
- READY_SCROLL_SPEED: 60 (px/s, ~30% of GAME_SPEED, slow idle hint on READY screen)

**New HUD config:**
- HUD_COLOR: '#FFD700' (gold for distance counter)
- PX_PER_METER: 10 (10 canvas pixels = 1 displayed meter)

**New countdown config:**
- COUNTDOWN_STEP: 0.8 (seconds per digit in 3-2-1-Go! countdown)
- COUNTDOWN_COLOR: '#FFD700' (gold for countdown numbers)
- COUNTDOWN_GO_COLOR: '#00FF88' (green for "Go!")

**New game over config:**
- GAME_OVER_FREEZE_DELAY: 1.0 (seconds of flash before showing text)
- GAME_OVER_COOLDOWN: 1.0 (seconds before Space accepted for restart)
- GAME_OVER_COLOR: '#FF4444' (red for Game Over text)
- FLASH_INTERVAL: 0.1 (seconds between flash toggles)

**Replace OBSTACLE_TYPES with rich version (3 types):**
```javascript
OBSTACLE_TYPES: [
  { name: 'kidney-stone', width: 30, height: 40, color: '#C4A35A', spawnRate: 1.0, movement: 'static' },
  { name: 'blockage',     width: 50, height: 30, color: '#8B4513', spawnRate: 0.7, movement: 'static' },
  { name: 'cyst',         width: 35, height: 35, color: '#9B59B6', spawnRate: 0.5, movement: 'float'  },
],
```

**Replace GENE_TYPES with rich version (6 genes with educational data):**
```javascript
GENE_TYPES: [
  {
    name: 'PKD1', geneName: 'Polycystin-1',
    geneDescription: 'Helps kidneys develop properly. Mutations cause cysts, leading to polycystic kidney disease.',
    color: '#E74C3C', points: 10, spawnRate: 1.0, movement: 'float',
  },
  {
    name: 'PKD2', geneName: 'Polycystin-2',
    geneDescription: 'Works with PKD1 to keep kidneys healthy. PKD2 mutations cause a milder polycystic kidney disease.',
    color: '#E67E22', points: 10, spawnRate: 1.0, movement: 'float',
  },
  {
    name: 'COL4A5', geneName: 'Collagen IV Alpha-5',
    geneDescription: 'Builds the kidney filter membrane. Mutations cause Alport syndrome with kidney failure and hearing loss.',
    color: '#3498DB', points: 15, spawnRate: 0.8, movement: 'float',
  },
  {
    name: 'NPHS1', geneName: 'Nephrin',
    geneDescription: 'Forms the kidney\\'s finest filter barrier. Mutations cause congenital nephrotic syndrome from birth.',
    color: '#2ECC71', points: 20, spawnRate: 0.6, movement: 'float',
  },
  {
    name: 'NPHS2', geneName: 'Podocin',
    geneDescription: 'Anchors the nephrin filter in place. Mutations cause steroid-resistant nephrotic syndrome in children.',
    color: '#F1C40F', points: 20, spawnRate: 0.6, movement: 'float',
  },
  {
    name: 'WT1', geneName: 'Wilms Tumor Protein 1',
    geneDescription: 'Controls kidney development. Mutations cause Wilms tumor (kidney cancer) and nephrotic syndrome.',
    color: '#9B59B6', points: 25, spawnRate: 0.4, movement: 'float',
  },
],
```

Add a comment block above the entity arrays: `// Entity types: data-driven arrays for Phase 4+ spawning. Select by name or spawnRate, never by index.`

Keep the config as a flat `export default { ... }` object. No Object.freeze. All values must be workshop-console-mutable via `CONFIG.GROUND_MARKER_COLOR = '#ff0000'` etc.
  </action>
  <verify>
Open index.html in browser. Open console. Verify:
- `CONFIG.OBSTACLE_TYPES.length === 3`
- `CONFIG.GENE_TYPES.length === 6`
- `CONFIG.GENE_TYPES[0].geneName === 'Polycystin-1'`
- `CONFIG.GROUND_MARKER_COLOR === '#3A78C2'`
- `CONFIG.READY_SCROLL_SPEED === 60`
- No console errors on page load
  </verify>
  <done>config.js contains bold color palette, ground marker config, scroll speeds, countdown/game-over timing constants, 3 obstacle types with spawnRate+movement, and 6 gene types with geneName+geneDescription+points+spawnRate+movement. All values accessible and mutable from browser console.</done>
</task>

<task type="auto">
  <name>Task 2: Replace static ground with scrolling two-tone ground and dash markers</name>
  <files>js/renderer.js, js/main.js</files>
  <action>
**In renderer.js:**

1. Rename `drawGroundLine` to `drawGround` (or add `drawGround` and remove `drawGroundLine`). The new function signature is `drawGround(ctx, config, groundOffset)` where `groundOffset` is the cumulative scroll distance in pixels.

2. `drawGround` implementation:
   - Fill the entire ground area (GROUND_Y to CANVAS_HEIGHT) with `config.GROUND_COLOR` (earth band)
   - Draw the bright surface line: `config.GROUND_LINE_COLOR`, height `config.GROUND_LINE_WIDTH` (4px), at GROUND_Y
   - Draw scrolling dash markers using the two-segment tile approach:
     - Calculate `phase = groundOffset % config.GROUND_MARKER_SPACING`
     - Loop from `-phase` to `CANVAS_WIDTH + GROUND_MARKER_SPACING`, stepping by `GROUND_MARKER_SPACING`
     - At each position, draw a filled rect: x=position, y=GROUND_Y + config.GROUND_MARKER_Y_OFFSET, width=config.GROUND_MARKER_WIDTH, height=config.GROUND_MARKER_HEIGHT, color=config.GROUND_MARKER_COLOR
     - Use `Math.round(x)` for crisp pixel alignment

3. Update the export list: replace `drawGroundLine` with `drawGround` in the named exports.

**In main.js:**

1. Update the import statement: replace `drawGroundLine` with `drawGround` in the import from './renderer.js'.

2. Add a module-level variable: `let groundOffset = 0;`

3. In the game loop, BEFORE drawing the ground each frame, update groundOffset based on game state:
   - If `gameState === 'READY'`: `groundOffset += CONFIG.READY_SCROLL_SPEED * deltaTime;`
   - (RUNNING, COUNTDOWN, PAUSED, GAME_OVER states will be handled in Plan 02)
   - For now, also handle `gameState === 'RUNNING'`: `groundOffset += CONFIG.GAME_SPEED * deltaTime;` so the ground scrolls at full speed when running.

4. Replace the `drawGroundLine(ctx, CONFIG)` call with `drawGround(ctx, CONFIG, groundOffset)`.

**Important:** Do NOT break the existing start screen or game loop. The READY screen must still show the title and pulsing "Press Space to Start" text ON TOP of the scrolling ground. The RUNNING state should show the ground scrolling at full speed (replacing the old static ground + placeholder text).

**Do NOT reference legacy files** (game.js, player.js, background.js, etc.).
  </action>
  <verify>
Open index.html in browser:
1. On READY screen: ground area is two-tone (bright blue surface line on top, darker blue-grey earth below), small dash markers scroll slowly left. Title and pulsing prompt are visible above the ground.
2. Press Space: game transitions to RUNNING. Ground scrolls noticeably faster. No visual jumps or gaps in the dash marker pattern.
3. No console errors.
4. Open console, type `CONFIG.GROUND_MARKER_SPACING = 50` -- markers become more frequent immediately (next frame picks up the change).
  </verify>
  <done>Static ground replaced with scrolling two-tone ground. Dash markers tile seamlessly using the modulo-based two-segment approach. Ground scrolls slowly on READY screen (60 px/s) and at full GAME_SPEED (200 px/s) during RUNNING. drawGround exported from renderer.js, groundOffset tracked in main.js.</done>
</task>

</tasks>

<verification>
- Open index.html: two-tone ground with scrolling dash markers visible on READY screen
- Ground scrolls slowly left on READY, fast on RUNNING
- No gaps or jumps in marker pattern at any speed
- CONFIG.OBSTACLE_TYPES has 3 entries with spawnRate and movement fields
- CONFIG.GENE_TYPES has 6 entries with geneName, geneDescription, points, spawnRate, movement fields
- All new config values accessible and mutable from browser console
- No console errors
</verification>

<success_criteria>
1. Ground displays as two-tone with scrolling dash markers on both READY and RUNNING screens
2. Config contains 3 obstacle types and 6 gene types with rich data-driven structure
3. Color palette is bold and playful (bright blue ground, gold HUD color in config)
4. All existing Phase 1 functionality preserved (start screen, input, state transitions)
</success_criteria>

<output>
After completion, create `.planning/phases/03-game-loop-scrolling/03-01-SUMMARY.md`
</output>
